{% extends "website/base.html" %}
{% load static %}

{% block title %}Agricultural Marketplace - Mkulima Smart{% endblock %}

{% block extra_css %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f4f7f0; --text:#1b3a2d; --muted:#5f7b6d; --card:#fff;
    --primary:#3d7a36; --secondary:#d4a017;
    --shadow-lg:0 25px 60px rgba(27,58,45,.08), 0 10px 20px rgba(27,58,45,.05);
    --shadow-md:0 10px 25px rgba(27,58,45,.08), 0 4px 10px rgba(27,58,45,.06);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--text);
    background:linear-gradient(180deg,var(--bg),#fff)}
  .container{max-width:1180px;margin:0 auto;padding:0 20px}

    /* Hero */
    .hero{position:relative;border-radius:28px;overflow:hidden;background:#000;height:380px;box-shadow:var(--shadow-lg)}
    .hero img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:contrast(1.05) saturate(1.05)}
    .hero::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,rgba(3,7,18,.75),rgba(3,7,18,.35) 55%,rgba(3,7,18,.15))}
    .hero-content{position:relative;z-index:1;color:#fff;padding:44px;max-width:640px;display:flex;flex-direction:column;gap:12px}
    .hero h1{margin:0;font-size:44px;line-height:1.05}
    .hero p{margin:0;color:#fff;max-width:520px}

    /* Search card */
    .search-card{position:relative;top:-40px;margin:0 auto;background:var(--card);border-radius:26px;
      padding:18px;display:grid;grid-template-columns:1fr 1fr 1fr 1fr 72px;gap:14px;align-items:center;box-shadow:var(--shadow-lg)}
    .search-item{padding:16px;border-radius:18px;background:linear-gradient(180deg,#fff,var(--bg));
      box-shadow:inset 0 1px 0 rgba(255,255,255,.75),0 1px 2px rgba(27,58,45,.04);border:1px solid var(--bg);min-height:78px}
    .label{font-weight:700;font-size:14px;color:var(--text);margin-bottom:6px}
    .hint,.search-item select,.search-item input{color:var(--muted);font-size:13px;border:none;background:transparent;outline:none;width:100%}
    .search-btn{height:78px;width:72px;border:none;border-radius:18px;background:var(--primary);color:#fff;display:grid;place-items:center;cursor:pointer;box-shadow:var(--shadow-md)}
    .search-btn:active{transform:translateY(1px)}
    .search-btn svg{width:24px;height:24px}

    /* Services grid */
    .section-title{margin:-18px 0 18px;text-align:center;font-weight:800;font-size:22px;color:var(--primary)}
    .cards{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-bottom:60px}
    .card{background:var(--card);border-radius:18px;overflow:hidden;box-shadow:var(--shadow-md);transition:transform .15s,box-shadow .15s}
    .card:hover{transform:translateY(-4px);box-shadow:0 18px 40px rgba(16,24,40,.12)}
    .card img{width:100%;height:150px;object-fit:cover}
    .card-body{padding:12px 14px 16px}
    .card h4{margin:6px 0 4px;font-size:15px}
    .meta{display:flex;justify-content:space-between;align-items:center;font-weight:700;font-size:14px}
    .sub{color:var(--muted);font-size:12px}

    .foot{padding:30px 0 50px;color:var(--muted);text-align:center;font-size:13px}

    /* Responsive */
    @media (max-width:980px){
      .search-card{grid-template-columns:1fr 1fr;row-gap:12px}
      .search-btn{width:100%}
      .cards{grid-template-columns:repeat(2,1fr)}
      .hero{height:360px}.hero h1{font-size:38px}
    }
    @media (max-width:640px){
      .nav{height:auto;padding:14px 0;gap:10px}
      .hero{height:320px;border-radius:22px}
      .hero-content{padding:28px}.hero h1{font-size:30px}
      .search-card{top:-26px;grid-template-columns:1fr}
      .cards{grid-template-columns:1fr}
    }
  /* Hero */
  .hero{position:relative;border-radius:28px;overflow:hidden;background:#000;height:380px;box-shadow:var(--shadow-lg)}
  .hero img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:contrast(1.05) saturate(1.05)}
  .hero::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,rgba(3,7,18,.75),rgba(3,7,18,.35) 55%,rgba(3,7,18,.15))}
  .hero-content{position:relative;z-index:1;color:#fff;padding:44px;max-width:640px;display:flex;flex-direction:column;gap:12px}
  .hero h1{margin:0;font-size:44px;line-height:1.05}
  .hero p{margin:0;color:#fff;max-width:520px}

  /* Search card */
  .search-card{position:relative;top:-40px;margin:0 auto;background:var(--card);border-radius:26px;
    padding:18px;display:grid;grid-template-columns:1fr 1fr 1fr 1fr 72px;gap:14px;align-items:center;box-shadow:var(--shadow-lg)}
  .search-item{padding:16px;border-radius:18px;background:linear-gradient(180deg,#fff,var(--bg));
    box-shadow:inset 0 1px 0 rgba(255,255,255,.75),0 1px 2px rgba(27,58,45,.04);border:1px solid var(--bg);min-height:78px}
  .label{font-weight:700;font-size:14px;color:var(--text);margin-bottom:6px}
  .hint,.search-item select,.search-item input{color:var(--muted);font-size:13px;border:none;background:transparent;outline:none;width:100%}
  .search-btn{height:78px;width:72px;border:none;border-radius:18px;background:var(--primary);color:#fff;display:grid;place-items:center;cursor:pointer;box-shadow:var(--shadow-md)}
  .search-btn:active{transform:translateY(1px)}
  .search-btn svg{width:24px;height:24px}

  /* Services grid */
  .section-title{margin:-18px 0 18px;text-align:center;font-weight:800;font-size:22px;color:var(--primary)}
  .cards{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-bottom:60px}
  .card{background:var(--card);border-radius:18px;overflow:hidden;box-shadow:var(--shadow-md);transition:transform .15s,box-shadow .15s}
  .card:hover{transform:translateY(-4px);box-shadow:0 18px 40px rgba(16,24,40,.12)}
  .card img{width:100%;height:150px;object-fit:cover}
  .card-body{padding:12px 14px 16px}
  .card h4{margin:6px 0 4px;font-size:15px}
  .meta{display:flex;justify-content:space-between;align-items:center;font-weight:700;font-size:14px}
  .sub{color:var(--muted);font-size:12px}

  .foot{padding:30px 0 50px;color:var(--muted);text-align:center;font-size:13px}

  /* Responsive */
  @media (max-width:980px){
    .search-card{grid-template-columns:1fr 1fr;row-gap:12px}
    .search-btn{width:100%}
    .cards{grid-template-columns:repeat(2,1fr)}
    .hero{height:360px}.hero h1{font-size:38px}
  }
  @media (max-width:640px){
    .nav{height:auto;padding:14px 0;gap:10px}
    .hero{height:320px;border-radius:22px}
    .hero-content{padding:28px}.hero h1{font-size:30px}
    .search-card{top:-26px;grid-template-columns:1fr}
    .cards{grid-template-columns:1fr}
  }
</style>
{% endblock %}

{% block content %}
<!-- App-specific Navigation -->
<nav class="bg-white shadow-sm w-full mt-2 mb-4">
  <div class="container mx-auto px-2 py-2">
    <div class="flex flex-row justify-between items-center">
      <div class="flex items-center">
        <span class="text-green-700 font-bold text-lg">Marketplace</span>
      </div>
      <div class="flex flex-wrap justify-end items-center space-x-4">
        <a href="#" class="py-1 px-1 text-gray-700 hover:text-green-600 hover:underline transition duration-300 ease-in-out font-medium text-sm">Products</a>
        <a href="#" class="py-1 px-1 text-gray-700 hover:text-green-600 hover:underline transition duration-300 ease-in-out font-medium text-sm">Services</a>
        <a href="#" class="py-1 px-1 text-gray-700 hover:text-green-600 hover:underline transition duration-300 ease-in-out font-medium text-sm">Library</a>
      </div>
    </div>
  </div>
</nav>

  <main class="container">
    <!-- Hero -->
    <section class="hero">
      <img src="https://images.unsplash.com/photo-1625246333195-78d9c38ad449?q=80&w=1600&auto=format&fit=crop" alt="Agricultural products and farming">
      <div class="hero-content">
        <h1>üåæ Agricultural<br/>Marketplace</h1>
        <p>Everything you need for modern farming - Seeds, Equipment, Fertilizers, Animal Feed & More</p>
      </div>
    </section>

    <!-- Search Card -->
    <form method="get" action="" class="search-card" aria-label="Find products">
      <div class="search-item">
        <div class="label">Search Products</div>
        <input type="text" name="q" placeholder="Seeds, Fertilizers, Equipment..." value="{{ query }}">
      </div>
      <div class="search-item">
        <div class="label">Category</div>
        <select name="category">
          <option value="">All Categories</option>
          {% for category in categories %}
          <option value="{{ category.id }}" {% if request.GET.category == category.id|stringformat:"s" %}selected{% endif %}>{{ category.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="search-item">
        <div class="label">Price Range</div>
        <input type="number" name="max_price" placeholder="Max Price (TZS)" value="{{ request.GET.max_price }}">
      </div>
      <div class="search-item">
        <div class="label">Region</div>
        <select name="region">
          <option value="">All Regions</option>
          {% for region in regions %}
          <option value="{{ region }}" {% if request.GET.region == region %}selected{% endif %}>{{ region }}</option>
          {% endfor %}
        </select>
      </div>
      <button type="submit" class="search-btn" aria-label="Search">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="11" cy="11" r="7" stroke-width="2"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65" stroke-width="2"></line>
        </svg>
      </button>
    </form>

    <!-- Products -->
    <h3 class="section-title">üå± Agricultural Products</h3>
    {% if products %}
    <section class="cards">
      {% for product in products %}
      <article class="card">
        {% if product.images.first %}
        <img src="{{ product.images.first.image.url }}" alt="{{ product.name }}">
        {% else %}
        <img src="https://images.unsplash.com/photo-1625246333195-78d9c38ad449?q=80&w=1200&auto=format&fit=crop" alt="{{ product.name }}">
        {% endif %}
        <div class="card-body">
          <div class="meta">
            <h4><a href="{% url 'website:product_detail' product.slug %}" style="color:inherit;text-decoration:none">{{ product.name }}</a></h4>
            <div style="color:#2D5A27;font-weight:800">TZS {{ product.price|floatformat:0 }}</div>
          </div>
          <div class="sub">{{ product.category.name }} ¬∑ {{ product.description|truncatewords:8 }}</div>
          {% if product.stock > 0 %}
          <a href="{% url 'website:add_to_cart' product.id %}" style="display:inline-block;margin-top:8px;padding:6px 14px;background:#C5D86D;color:#1A3316;border-radius:8px;text-decoration:none;font-size:13px;font-weight:600">üõí Add to Cart</a>
          {% else %}
          <span style="display:inline-block;margin-top:8px;padding:6px 14px;background:#dc3545;color:white;border-radius:8px;font-size:13px;font-weight:600">Out of Stock</span>
          {% endif %}
        </div>
      </article>
      {% endfor %}
    </section>
    
    <!-- Pagination -->
    {% if is_paginated %}
    <div style="display:flex;justify-content:center;gap:8px;margin:40px 0">
      {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}{% if query %}&q={{ query }}{% endif %}" style="padding:8px 16px;background:white;border:2px solid #e9ecef;border-radius:8px;text-decoration:none;color:#2D5A27;font-weight:600">‚Üê Previous</a>
      {% endif %}
      
      <span style="padding:8px 16px;background:#2D5A27;color:white;border-radius:8px;font-weight:600">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
      
      {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}{% if query %}&q={{ query }}{% endif %}" style="padding:8px 16px;background:white;border:2px solid #e9ecef;border-radius:8px;text-decoration:none;color:#2D5A27;font-weight:600">Next ‚Üí</a>
      {% endif %}
    </div>
    {% endif %}
    {% else %}
    <div style="text-align:center;padding:60px 20px">
      <div style="font-size:64px;margin-bottom:20px">üì¶</div>
      <h3 style="color:#2D5A27;margin-bottom:10px">No Products Yet</h3>
      <p style="color:#6c757d">Products will appear here once they are added to the marketplace.</p>
    </div>
    {% endif %}
  </main>
{% endblock %}
